#include <SDL2/SDL.h>
#include "raycaster.h"
#include "gameMap.h"

int worldMap[MAP_WIDTH][MAP_HEIGHT] = {
    {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,2,2,2,2,0,0,4,4,4,4,4,0,0,0,5,5,5,5,5,0,0,0,3,3,3,3,3,0,0,1},
    {1,0,2,0,0,2,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,3,0,0,0,3,0,0,1},
    {1,0,2,0,0,0,0,0,4,0,0,0,4,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,3,0,0,1},
    {1,0,2,0,0,2,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,3,0,0,0,3,0,0,1},
    {1,0,2,2,0,2,0,0,4,4,0,4,4,0,0,0,5,5,0,5,5,0,0,0,3,3,0,3,3,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1},
    {1,0,1,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0,0,0,1,0,1},
    {1,0,1,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,1,0,1},
    {1,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,1},
    {1,0,1,0,0,0,0,0,2,0,0,0,5,5,5,5,5,5,0,0,0,2,0,0,0,0,0,0,0,1,0,1},
    {1,0,1,0,0,0,0,0,2,0,0,0,5,0,0,0,0,5,0,0,0,2,0,0,0,0,0,0,0,1,0,1},
    {1,0,1,0,0,0,0,0,0,0,0,0,5,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,1,0,1},
    {1,0,1,0,0,0,0,0,2,0,0,0,5,0,0,0,0,5,0,0,0,2,0,0,0,0,0,0,0,1,0,1},
    {1,0,1,0,0,0,0,0,2,0,0,0,5,5,0,5,5,5,0,0,0,2,0,0,0,0,0,0,0,1,0,1},
    {1,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,1},
    {1,0,1,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,1,0,1},
    {1,0,1,1,1,0,0,0,2,2,2,2,2,0,0,0,2,2,2,2,2,2,0,0,0,0,0,1,1,1,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,4,4,4,4,4,0,0,0,3,0,0,0,2,0,0,0,5,0,0,0,1,1,1,1,1,1,1,0,0,1},
    {1,0,4,0,0,0,4,0,0,0,3,0,0,0,2,0,0,0,5,0,0,0,1,0,0,0,0,0,1,0,0,1},
    {1,0,4,0,5,0,4,0,0,0,3,3,3,3,3,3,3,3,3,0,0,0,1,0,5,5,5,0,1,0,0,1},
    {1,0,4,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,5,0,5,0,1,0,0,1},
    {1,0,4,4,0,4,4,0,0,0,3,3,3,3,0,3,3,3,3,0,0,0,1,0,5,5,5,0,1,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,0,0,0,0,0,0,0,0,0,3,3,3,3,0,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,1},
    {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}
};

int main(int argc, char* argv[]) {
    if (SDL_Init(SDL_INIT_VIDEO) < 0) return -1;

    int w = 800, h = 600;
    SDL_Window* window = SDL_CreateWindow("Raycaster", 
            SDL_WINDOWPOS_CENTERED, SDL_WINDOWPOS_CENTERED, 
            w, h, SDL_WINDOW_SHOWN | SDL_WINDOW_RESIZABLE);
    SDL_Renderer* renderer = SDL_CreateRenderer(window, -1, 
            SDL_RENDERER_ACCELERATED | SDL_RENDERER_PRESENTVSYNC);

    SDL_SetRelativeMouseMode(SDL_TRUE);

    Raycaster game(w, h);
    Uint32 lastTime = SDL_GetTicks();
    bool running = true;
    SDL_Event e;

    while (running) {
        while (SDL_PollEvent(&e)) {
            if (e.type == SDL_QUIT) 
                running = false;
        }

        const Uint8* state = SDL_GetKeyboardState(NULL);
        if (state[SDL_SCANCODE_ESCAPE]) running = false;

        Uint32 currentTime = SDL_GetTicks();
        double frameTime = (currentTime - lastTime) / 1000.0;
        lastTime = currentTime;
        if (frameTime > 0.1) frameTime = 0.016;

        SDL_SetRenderDrawColor(renderer, 0, 0, 0, 255);
        SDL_RenderClear(renderer);

        game.handleInput(SDL_GetKeyboardState(NULL), frameTime * 5.0, frameTime * 3.0);
        
        SDL_GetWindowSize(window, &w, &h);
        game.render(renderer, w, h);

        SDL_RenderPresent(renderer);
    }

    SDL_DestroyRenderer(renderer);
    SDL_DestroyWindow(window);
    SDL_Quit();
    return 0;
}
